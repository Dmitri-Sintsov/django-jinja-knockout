{% macro ko_grid_body(include_ids=None, exclude_ids=None) -%}

{% set _include_ids = set([
    'ko_range_filter',
    'ko_grid_row_click_menu',
    'ko_action_form',
    'ko_grid_filter_choices',
    'ko_grid_filter_popup',
    'ko_grid_search',
    'ko_grid_nav',
    'ko_grid_bottom_nav',
    'ko_grid_no_results',
    'ko_grid_table',
    'ko_grid_body',
    'ko_grid_pagination',
    'ko_grid_rows_per_page_dialog'
]) -%}

{% if include_ids is not none -%}
    {% set _include_ids = _include_ids.union(include_ids) -%}
{% endif -%}

{% if exclude_ids is not none -%}
    {% set _include_ids = _include_ids.difference(exclude_ids) -%}
{% endif -%}

{% if 'ko_range_filter' in _include_ids -%}
<script type="text/template" id="ko_range_filter">
    <div class="panel panel-default">
        <div class="panel-body">
            <div class="row form-group">
                <label v-text="meta.from" class="control-label col-md-4" for="id_range_from"></label>
                <div class="field col-md-6">
                    <input v-model="from" v-bind="fieldAttrs" id="id_range_from" name="range_from">
                </div>
                <label v-text="meta.to" class="control-label col-md-4" for="id_range_to"></label>
                <div class="field col-md-6">
                    <input v-model="to" v-bind="fieldAttrs" id="id_range_to" name="range_to">
                </div>
            </div>
        </div>
    </div>
</script>
{% endif -%}

{% if 'ko_grid_row_click_menu' in _include_ids -%}
<script type="text/template" id="ko_grid_row_click_menu">
    <div v-for="action in getEnabledActions(lastClickedKoRow, 'click')">
        <button class="btn btn-block" v-bind:class="action.actionCss()" v-on:click="action.doLastClickedRowAction" v-text="action.localName">
        </button>
    </div>
</script>
{% endif -%}

{% if 'ko_action_form' in _include_ids -%}
<!-- 'ko_action_form' template is not actual template but a skeleton of action template for App.ActionTemplateDialog class. -->
<script type="text/template" id="ko_action_form">
    <div class="panel panel-default">
        <div class="panel-body">
            <form class="ajax-form" enctype="multipart/form-data" method="post" role="form" v-bind="{'data-url': actions.getLastActionUrl()}">
                <input type="hidden" name="csrfmiddlewaretoken" v-bind:value="actions.getCsrfToken()">
                <input type="hidden" name="pk_val" v-bind:value="getLastPkVal()">
                <div class="jumbotron">
                    <div class="default-padding">
                        This is the sample template. Copy this template with another id then add your MVVM fields here.
                    </div>
                </div>
            </form>
        </div>
    </div>
</script>
{% endif -%}

{% if 'ko_grid_filter_choices' in _include_ids -%}
<script type="text/template" id="ko_grid_filter_choices">
    <li v-grid-filter="gridFilter" v-bind:class="{'bg-info': gridFilter.hasActiveChoices()}" class="dropdown">
        <a v-on:click="gridFilter.onDropdownClick()" aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#">
            <span v-text="gridFilter.name"></span> <b class="caret"></b>
        </a>
        <ul v-for="filterChoice in gridFilter.choices" class="dropdown-menu">
            <li v-bind:class="{active: filterChoice.is_active()}">
                <a v-grid-filter-choice="filterChoice" v-text="filterChoice.name" v-on:click="filterChoice.onLoadFilter()" name="#"></a>
            </li>
        </ul>
    </li>
</script>
{% endif -%}


{% if 'ko_grid_breadcrumb_filter_choices' in _include_ids -%}
<script type="text/template" id="ko_grid_breadcrumb_filter_choices">
    <li v-grid-filter="gridFilter">
        <ol class="breadcrumb grid-breadcrumb">
            <li class="bold" v-text="name"></li>
            <template v-for="filterChoice in gridFilter.choices">
            <li v-bind:class="{active: filterChoice.is_active}">
                <a v-bind:class="{bold: filterChoice.is_active}"
                   v-text="filterChoice.name"
                   v-grid-filter-choice="filterChoice"
                   v-on:click="filterChoice.onLoadFilter()"
                   name="#"></a>
            </li>
            </template>
        </ol>
    </li>
</script>
{% endif -%}

{% if 'ko_grid_filter_popup' in _include_ids -%}
<script type="text/template" id="ko_grid_filter_popup">
    <li v-grid-filter="gridFilter" v-bind:class="{'bg-info': gridFilter.hasActiveChoices()}" class="dropdown">
        <a v-on:click="gridFilter.onDropdownClick()" aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#">
            <span v-text="gridFilter.name"></span> <b class="caret"></b>
        </a>
    </li>
</script>
{% endif -%}

{% if 'ko_grid_breadcrumb_filter_popup' in _include_ids -%}
<script type="text/template" id="ko_grid_breadcrumb_filter_popup">
    <li v-grid-filter="gridFilter">
        <ol class="breadcrumb grid-breadcrumb">
            <li>
                <a v-on:click="gridFilter.onDropdownClick()" v-bind:class="{'bold': gridFilter.hasActiveChoices()}" href="#">
                    <span v-text="gridFilter.name"></span> <b class="caret"></b>
                </a>
            </li>
        </ol>
    </li>
</script>
{% endif -%}

{% if 'ko_grid_search' in _include_ids -%}
<script type="text/template" id="ko_grid_search">
    <form v-show="meta.hasSearch || actionTypes['button'].length > 0" class="navbar-form navbar-left">
        <div v-if="meta.hasSearch" class="form-group">
            <input v-model="gridSearchDisplayStr" v-bind="{placeholder: meta.searchPlaceholder}" class="form-control" type="search">
            <button v-on:click="onSearchReset" class="btn btn-default">{{ _('Clear') }}</button>
        </div>
        <template v-for="buttonAction in actionTypes['button']">
            <button class="btn" v-bind:class="buttonAction.actionCss('button')" v-on:click="buttonAction.doAction()">
                <span class="glyphicon" v-bind:class="buttonAction.actionCss('glyphicon')"></span>
                <span v-text="buttonAction.localName"></span>
            </button>
        </template>
    </form>
</script>
{% endif -%}

{% if 'ko_grid_nav' in _include_ids -%}
<script type="text/template" id="ko_grid_nav">
    <nav class="nav navbar navbar-default">
        <div class="container-fluid grid-controls">
            <ul v-for="gridFilter in gridFilters" class="nav navbar-nav">
                <div v-if="choices === undefined" data-template-id="ko_grid_filter_popup"></div>
                <div v-if="choices !== undefined" data-template-id="ko_grid_filter_choices"></div>
            </ul>
            <div data-template-id="ko_grid_search"></div>
        </div>
    </nav>
</script>
{% endif -%}

{% if 'ko_grid_bottom_nav' in _include_ids -%}
<script type="text/template" id="ko_grid_bottom_nav">
    <div class="navbar navbar-left">
        <template v-for="buttonAction in actionTypes['button_footer']">
            <button class="btn" v-bind:class="buttonAction.actionCss('button')" v-on:click="buttonAction.doAction()">
                <span class="glyphicon" v-bind:class="buttonAction.actionCss('glyphicon')"></span>
                <span v-text="buttonAction.localName"></span>
            </button>
        </template>
    </div>
</script>
{% endif -%}

{% if 'ko_grid_no_results' in _include_ids -%}
<script language="text/template" id="ko_grid_no_results">
    <div class="panel panel-default">
        <div class="panel-heading">
            {{ _(
                'No %(verbose_name)s found matching the query',
                verbose_name=mark_safe('<span v-text="meta.verboseName"></span>'
            )) }}.
        </div>
    </div>
</script>
{% endif -%}

{% if 'ko_grid_table' in _include_ids -%}
<script type="text/template" id="ko_grid_table">
    <div data-top="true">
        <div class="table-responsive" <% if (self.get('vscroll')) { %> style="overflow-y: scroll;" <% } %> >
            <table class="table table-bordered table-hover table-collapse" <% if (self.get('vscroll')) { %> style="margin-bottom: 0;" <% } %>>
                <thead>
                    <tr v-bind:class="headerCss">
                        <template v-if="ctrl.options.showSelection">
                            <th v-if="ctrl.options.selectMultipleRows" class="grid-glyph-cell">
                                <span v-bind:class="selectAllRowsCss" v-on:click="onSelectAllRows" class="halflings glyphicon glyphicon-unchecked"></span>
                            </th>
                        </template>
                        <template v-if="glyphiconColumns">
                            <th class="grid-glyph-cell"></th>
                        </template>
                        <template v-for="gridColumn in gridColumns">
                            <grid-column-header v-bind:column="gridColumn"></grid-column-header>
                        </template>
                    </tr>
                </thead>
                <% if (self.get('vscroll')) { %>
            </table>
        </div>
        <div class="table-responsive vscroll" style="overflow-y: scroll;">
            <table class="table table-bordered table-hover table-collapse">
                <% } %>
                <tbody>
                    <tr is="grid-row-component"
                        v-for="(gridRow, key, index) in gridRows" :key="key"
                        data-bind="foreach: {data: gridRows, afterRender: afterRowRender.bind($data)}"
                        v-grid-row="gridRow"
                        v-bind:class="gridRow.rowCss">
                        <td v-if="ctrl.options.showSelection" v-on:click="gridRow.onSelect" class="grid-glyph-cell">
                            <span v-bind:class="gridRow.selectionCss" class="halflings glyphicon"></span>
                        </td>
                        <td v-if="glyphiconColumns" class="grid-glyph-cell grid-glypicon-actions">
                            <template v-for="cellAction in $parent.actionTypes['glyphicon']">
                                <span v-if="$parent.observeEnabledAction(cellAction)"
                                      v-bind:class="cellAction.actionCss()"
                                      v-bind="{title: cellAction.localName}"
                                      v-on:click="cellAction.doForRow($parent)"
                                      class="halflings glyphicon pointer"></span>
                            </template>
                        </td>
                        <td v-for="(gridColumn, key) in gridColumns"
                            v-on:click="gridRow.onRowClick"
                            v-bind="{index: key, 'data-caption': gridColumn.names}"
                            v-bind:class="gridColumn.columnCss"
                            v-grid-row-values="gridColumn"></td>
                    </tr>
                </tbody>
                <tfoot class="jumbotron default-padding" v-show="gridRows.length === 0">
                    <tr>
                        <td v-bind="{colspan: totalColumns}">
                            <div data-template-id="ko_grid_no_results"></div>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</script>
{% endif -%}

{% if 'ko_grid_body' in _include_ids -%}
<script type="text/template" id="ko_grid_body">
    <div <% if (self.get('show_title')) { %> class="panel panel-primary" <% } %>>
        <% if (self.get('show_title')) { %>
        <div v-text="meta.verboseNamePlural" class="panel-heading"></div>
        <div class="panel-body">
        <% } %>
            <div v-if="meta.hasSearch || gridFilters.length > 0 || actionTypes['button'].length > 0" data-template-id="ko_grid_nav"></div>
            <div data-template-id="ko_grid_table"></div>
        <% if (self.get('show_pagination')) { %>
            <div data-template-id="ko_grid_pagination"></div>
        <% } %>
            <div v-if="actionTypes['button_footer'].length > 0" data-template-id="ko_grid_bottom_nav"></div>
        <% if (self.get('show_title')) { %>
        </div>
        <% } %>
    </div>
</script>
{% endif -%}

{% if 'ko_grid_pagination' in _include_ids -%}
<script type="text/template" id="ko_grid_pagination">
    <div v-show="ctrl.options.alwaysShowPagination || gridTotalPages > 1" class="pagination-wrapper default-padding">
        <ul class="pagination">
            <template v-for="paginationAction in actionTypes['pagination']">
                <li v-on:click="paginationAction.doAction()">
                    <span class="halflings glyphicon" v-bind:class="paginationAction.actionCss('glyphicon')" v-bind="{title: paginationAction.localName}"></span>
                </li>
            </template>
            <template v-for="page in gridPages">
                <li v-bind:class="{active: page.isActive}">
                    <a v-text="page.title" v-on:click="page.onPagination" name="#"></a>
                </li>
            </template>
        </ul>
    </div>
</script>
{% endif -%}

{% if 'ko_grid_rows_per_page_dialog' in _include_ids -%}
<script id="ko_grid_rows_per_page_dialog" language="text/html">
    <div class="panel panel-default">
        <div class="panel-heading flex-space-between" >
            <div v-for="val in meta.rowsPerPageValues" v-text="val"></div>
        </div>
        <div class="panel-body">
            <input type="range" v-bind="meta.rowsPerPageRange" v-model="meta.rowsPerPage" list="tickmarks">
            <datalist id="tickmarks">
                <option v-for="val in meta.rowsPerPageValues" v-bind="{value: val}">
            </datalist>
        </div>
    </div>
</script>
{% endif -%}

<script id="grid-column-header" language="text/x-template">
    <th>
        <grid-column-order v-for="columnOrder in column.columnOrders" v-bind:column-order="columnOrder"></grid-column-order>
    </th>
</script>

<script id="grid-column-order" language="text/x-template">
    <a v-if="columnOrder.isSorted"
       v-text="columnOrder.name"
       v-grid-order-by="columnOrder"
       v-on:click="onSwitchOrder"
       v-bind:class="columnOrder.orderCss"
       class="halflings-before"
       name="#"></a>
    <div v-else v-text="columnOrder.name"></div>
</script>

{% endmacro -%}
{% if _render_ -%}
    {% if not include_ids is defined -%}
        {% set include_ids = {} -%}
    {% endif -%}
    {% if not exclude_ids is defined -%}
        {% set exclude_ids = {} -%}
    {% endif -%}
    {{ ko_grid_body(include_ids=include_ids, exclude_ids=exclude_ids) }}
{% endif -%}
