{# https://gist.github.com/bearz/7394681 #}
{% macro bs_form(form, action, opts, method='post') -%}
{% from 'bs_form_body.htm' import bs_form_body with context %}
{% if not opts.class %}
    {% do opts.update({'class': ''}) %}
{% endif %}
{% if not opts.layout_classes %}
    {% do opts.update({'layout_classes': {}}) %}
{% endif %}
<div class="panel panel-default {{ opts.class }}">
    {% if opts.title is defined %}
    <div class="panel-heading"><h3 class="panel-title">{{ opts.title }}</h3></div>
    {% endif %}
    <div class="panel-body">
        {% if opts.is_ajax %}
            {% set atts = {'data-url': action, 'class': 'ajax-form'} %}
        {% else %}
            {% set atts = {'action': action} %}
        {% endif %}
        {% do atts.update({
            'method': method,
            'enctype': "multipart/form-data",
            'role': 'form'
        }) %}
        <form{{ flatatt(atts) }}>
            {{ bs_form_body(form, opts.layout_classes) }}
            {% if opts.submit_text is defined %}
            <button type="submit" class="btn btn-primary">{{ opts.submit_text }}</button>
            {% endif %}
            {% if caller %}
                {{ caller() }}
            {% endif %}
        </form>
    </div>
</div>
{%- endmacro %}
{% if _render_form %}
{{ bs_form(form, action, opts) }}
{% endif %}
